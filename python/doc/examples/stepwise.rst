
Stepwise method
===============

.. code:: python

    import openturns as ot
    import otlm
    from math import log
    
    sample = ot.Sample.ImportFromTextFile("DATA_test1.csv", ",")
    
    X = sample[:, 1:5]
    R = sample[:, 0]
    
    myLinearModel = ot.Function(['x1', 'x2', 'x3', 'x4'], ['y'],
        ['14 - 7*x1 - 17*x2 - 7 *x3 - 3*x4 + 13*x3^2 - 16*x4^2 ' +
           ' - 4*x1^2 + 12*x1*x2 + 3*x2*x4 + 13*x3*x4 + 20*x1*x2*x3 ' +
           ' + 17*x1^3 - 10*x2^3 + 7*x4^3'])
    
    Y = myLinearModel(X) + R
    
    ################################################################################################
    # Build a model Y~(X1+X2+X3+X4)^3+I(Xi)^2+I(Xi)^3
    dim = X.getDimension()
    enumerateFunction = ot.EnumerateFunction(dim)
    factory = ot.OrthogonalProductPolynomialFactory([otlm.MonomialFactory()]*dim, enumerateFunction)
    
    # Build 'interactions' as a list of list [a1,a2,a3,a4], and we will generate tensorized
    # polynomials x1^a1*x2^a2*x3^a3*x4^a4.
    
    # Y ~ (X1+X2+X3+X4)^4
    interactions = [x for x in ot.Tuples([2]*dim).generate()]
    # Remove X1*X2*X3*X4 to obtain Y ~ (X1+X2+X3+X4)^3
    interactions.pop(interactions.index([1]*dim))
    for i in range(dim):
      indices = [0]*dim
      indices[i] = 2
      # Y ~ I(Xi)^2
      interactions.append(indices[:])
      # Y ~ I(Xi)^3
      indices[i] = 3
      interactions.append(indices[:])
    
    funcs = [factory.build(enumerateFunction.inverse(indices)) for indices in interactions]
    [f.getEvaluation().setInputDescription(X.getDescription()) for f in funcs]
    basis = ot.Basis(funcs)
    ################################################################################################
    
    i_min = [interactions.index([0,0,0,0])]
    i_0 = i_min[:]
    for i in range(dim):
      indices = [0]*dim
      indices[i] = 1
      i_0.append(interactions.index(indices))
    
    #---------------- Forward / Backward-------------------
    #   X: input sample
    #   basis : Basis
    #   Y: output sample
    #   i_min:  indices of minimal model
    #   direction: Boolean (True FORWARD, False BACKWARD)
    #   penalty: multiplier of number of degrees of freedom
    #   maxiteration: maximum number of iterations
    
    #---------------- Both-------------------
    #   X: input sample
    #   basis : Basis
    #   Y: output sample
    #   i_min : indices of minimal model
    #   i_0   : indices of start model
    #   penalty: multiplier of number of degrees of freedom
    #   maxiteration: maximum number of iterations
    
    penalty_BIC = log(X.getSize())
    penalty_AIC = 2.
    maxiteration = 1000
    
    for k in [penalty_AIC, penalty_BIC]:
      ## Forward / Backward
      if k==penalty_AIC:  IC =" AIC "
      if k==penalty_BIC:  IC =" BIC "
      for forward in [True, False]:
        algo = otlm.LinearModelStepwiseAlgorithm(X, basis, Y, i_min, forward, k, maxiteration)
        algo_result = otlm.LinearModelAnalysis(algo.getResult())
        print("{0:~^60s}".format(""))
        if forward==True : print(" Forward " +IC)
        else             : print(" Backward "+IC)
        print("{0:~^60s}".format(""))
        print(algo_result)
      ## Both
      algo = otlm.LinearModelStepwiseAlgorithm(X, basis, Y, i_min, i_0, k, maxiteration)
      algo_result = otlm.LinearModelAnalysis(algo.getResult())
      print("{0:~^60s}".format(""))
      print(" Both "+IC)
      print("{0:~^60s}".format(""))
      print(algo_result)
    
.. parsed-literal::
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     Forward  AIC
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Basis( [1,X1,X2,(X1) * (X2),X3,(X1) * (X3),(X2) * (X3),(X1) * (X2) * (X3),X4,(X1) * (X4),(X2) * (X4),(X1) * (X2) * (X4),(X3) * (X4),(X1) * (X3) * (X4),(X2) * (X3) * (X4),X1^2,X1^3,X2^2,X2^3,X3^2,X3^3,X4^2,X4^3]#23 )
    
    Coefficients:
                       | Estimate    | Std Error   | t value     | Pr(>|t|)    |
    ----------------------------------------------------------------------------
    1                  | 10.9814     | 0.65648     | 16.7277     | 1.27112e-28 |
    (X1) * (X3)        | -3.88875    | 1.9846      | -1.95946    | 0.0533367   |
    X2^2               | 7.18917     | 8.49215     | 0.846566    | 0.399614    |
    (X1) * (X2) * (X3) | 18.6503     | 2.15953     | 8.63624     | 2.94296e-13 |
    X3^3               | 9.55935     | 0.861055    | 11.1019     | 3.21154e-18 |
    X1^3               | 14.3043     | 1.03648     | 13.8009     | 2.04805e-23 |
    (X1) * (X4)        | -11.6087    | 1.83235     | -6.33539    | 1.08208e-08 |
    (X1) * (X2) * (X4) | 9.8174      | 2.11831     | 4.63455     | 1.28003e-05 |
    (X1) * (X3) * (X4) | 5.86969     | 2.9541      | 1.98696     | 0.0501475   |
    X4^2               | -4.64921    | 1.50572     | -3.0877     | 0.00272418  |
    (X3) * (X4)        | 9.9525      | 1.56499     | 6.35948     | 9.73106e-09 |
    X2                 | -16.4775    | 3.73193     | -4.41527    | 2.94963e-05 |
    X2^3               | -16.4804    | 5.66605     | -2.90862    | 0.00463118  |
    (X1) * (X2)        | 4.14884     | 1.9234      | 2.15704     | 0.033826    |
    X4                 | -3.25933    | 1.65126     | -1.97385    | 0.0516471   |
    ----------------------------------------------------------------------------
    
    Residual standard error: 0.93463 on 85 degrees of freedom
    F-statistic: 620.59 ,  p-value: 0
    ---------------------------------
    Multiple R-squared   | 0.990312 |
    Adjusted R-squared   | 0.988716 |
    ---------------------------------
    
    ---------------------------------
    Normality test       | p-value  |
    ---------------------------------
    Anderson-Darling     | 0.132184 |
    Chi-Squared          | 0.562718 |
    Kolmogorov-Smirnov   | 0.620456 |
    ---------------------------------
    
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     Backward  AIC
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Basis( [1,X1,X2,(X1) * (X2),X3,(X1) * (X3),(X2) * (X3),(X1) * (X2) * (X3),X4,(X1) * (X4),(X2) * (X4),(X1) * (X2) * (X4),(X3) * (X4),(X1) * (X3) * (X4),(X2) * (X3) * (X4),X1^2,X1^3,X2^2,X2^3,X3^2,X3^3,X4^2,X4^3]#23 )
    
    Coefficients:
                       | Estimate    | Std Error   | t value     | Pr(>|t|)    |
    ----------------------------------------------------------------------------
    1                  | 14.4696     | 0.85367     | 16.9499     | 1.10055e-28 |
    X1                 | -4.96924    | 1.13775     | -4.36761    | 3.6037e-05  |
    X2                 | -19.6298    | 1.96072     | -10.0115    | 6.24137e-16 |
    (X1) * (X2)        | 11.8902     | 2.08797     | 5.6946      | 1.82096e-07 |
    X3                 | -8.79793    | 1.85144     | -4.75195    | 8.3525e-06  |
    (X2) * (X3)        | 6.52733     | 2.99453     | 2.17975     | 0.0321087   |
    (X1) * (X2) * (X3) | 13.9549     | 3.1442      | 4.43829     | 2.76759e-05 |
    X4                 | -10.1758    | 1.96078     | -5.18967    | 1.46874e-06 |
    (X1) * (X4)        | -5.60052    | 2.132       | -2.62688    | 0.0102606   |
    (X2) * (X4)        | 10.2331     | 2.74482     | 3.72817     | 0.000351322 |
    (X3) * (X4)        | 14.3123     | 3.13008     | 4.57249     | 1.66633e-05 |
    (X1) * (X3) * (X4) | 3.92134     | 3.01451     | 1.30082     | 0.19692     |
    (X2) * (X3) * (X4) | -8.77332    | 4.2304      | -2.07388    | 0.0411906   |
    X1^3               | 14.768      | 0.974922    | 15.1479     | 1.30072e-25 |
    X2^3               | -11.8816    | 0.958026    | -12.4021    | 1.36769e-20 |
    X3^2               | 14.0536     | 1.33682     | 10.5127     | 6.33754e-17 |
    X4^3               | -3.25468    | 0.917225    | -3.54839    | 0.000640898 |
    ----------------------------------------------------------------------------
    
    Residual standard error: 0.88446 on 83 degrees of freedom
    F-statistic: 607.11 ,  p-value: 0
    ---------------------------------
    Multiple R-squared   | 0.991528 |
    Adjusted R-squared   | 0.989895 |
    ---------------------------------
    
    ---------------------------------
    Normality test       | p-value  |
    ---------------------------------
    Anderson-Darling     | 0.197651 |
    Chi-Squared          | 0.125636 |
    Kolmogorov-Smirnov   | 0.482042 |
    ---------------------------------
    
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     Both  AIC
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Basis( [1,X1,X2,(X1) * (X2),X3,(X1) * (X3),(X2) * (X3),(X1) * (X2) * (X3),X4,(X1) * (X4),(X2) * (X4),(X1) * (X2) * (X4),(X3) * (X4),(X1) * (X3) * (X4),(X2) * (X3) * (X4),X1^2,X1^3,X2^2,X2^3,X3^2,X3^3,X4^2,X4^3]#23 )
    
    Coefficients:
                       | Estimate    | Std Error   | t value     | Pr(>|t|)    |
    ----------------------------------------------------------------------------
    1                  | 12.7086     | 0.624644    | 20.3453     | 7.94404e-35 |
    X1                 | -5.46036    | 1.10552     | -4.93919    | 3.75912e-06 |
    X2                 | -15.855     | 1.19992     | -13.2134    | 1.65462e-22 |
    X4                 | -9.23488    | 1.1925      | -7.74411    | 1.63394e-11 |
    (X1) * (X2) * (X3) | 16.9437     | 1.53474     | 11.0401     | 3.14529e-18 |
    X3^3               | 8.78174     | 0.688698    | 12.7512     | 1.29079e-21 |
    (X1) * (X2)        | 11.2068     | 1.39616     | 8.02686     | 4.36462e-12 |
    (X3) * (X4)        | 11.8023     | 1.03538     | 11.399      | 5.99206e-19 |
    X4^3               | -2.95993    | 0.922675    | -3.20799    | 0.00187159  |
    (X2) * (X4)        | 4.98183     | 1.18419     | 4.20694     | 6.26974e-05 |
    X1^3               | 14.1106     | 0.968097    | 14.5756     | 4.49373e-25 |
    X2^3               | -12.3915    | 0.951199    | -13.0273    | 3.77309e-22 |
    (X1) * (X4)        | -2.78756    | 1.28899     | -2.1626     | 0.0333158   |
    ----------------------------------------------------------------------------
    
    Residual standard error: 0.90426 on 87 degrees of freedom
    F-statistic: 773.79 ,  p-value: 0
    ---------------------------------
    Multiple R-squared   | 0.990718 |
    Adjusted R-squared   | 0.989437 |
    ---------------------------------
    
    ---------------------------------
    Normality test       | p-value  |
    ---------------------------------
    Anderson-Darling     | 0.128032 |
    Chi-Squared          | 0.317021 |
    Kolmogorov-Smirnov   | 0.606542 |
    ---------------------------------
    
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     Forward  BIC
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Basis( [1,X1,X2,(X1) * (X2),X3,(X1) * (X3),(X2) * (X3),(X1) * (X2) * (X3),X4,(X1) * (X4),(X2) * (X4),(X1) * (X2) * (X4),(X3) * (X4),(X1) * (X3) * (X4),(X2) * (X3) * (X4),X1^2,X1^3,X2^2,X2^3,X3^2,X3^3,X4^2,X4^3]#23 )
    
    Coefficients:
                       | Estimate    | Std Error   | t value     | Pr(>|t|)    |
    ----------------------------------------------------------------------------
    1                  | 10.3793     | 0.591016    | 17.5618     | 3.48943e-30 |
    (X1) * (X3)        | -4.29201    | 2.00702     | -2.13849    | 0.0353128   |
    X2^2               | 5.46835     | 8.58833     | 0.636719    | 0.525999    |
    (X1) * (X2) * (X3) | 17.9846     | 2.16866     | 8.29297     | 1.34925e-12 |
    X3^3               | 9.92345     | 0.85511     | 11.6049     | 2.75263e-19 |
    X1^3               | 14.3108     | 1.05378     | 13.5804     | 4.16424e-23 |
    (X1) * (X4)        | -12.4907    | 1.8067      | -6.91358    | 7.84586e-10 |
    (X1) * (X2) * (X4) | 9.36335     | 2.14094     | 4.37347     | 3.41352e-05 |
    (X1) * (X3) * (X4) | 7.80951     | 2.83236     | 2.75724     | 0.00711774  |
    X4^2               | -6.96187    | 0.96153     | -7.2404     | 1.76982e-10 |
    (X3) * (X4)        | 8.88511     | 1.49311     | 5.95073     | 5.62382e-08 |
    X2                 | -16.1115    | 3.78956     | -4.25155    | 5.37021e-05 |
    X2^3               | -15.1689    | 5.72092     | -2.65148    | 0.00954014  |
    (X1) * (X2)        | 4.98412     | 1.9076      | 2.61277     | 0.0105991   |
    ----------------------------------------------------------------------------
    
    Residual standard error: 0.95024 on 86 degrees of freedom
    F-statistic: 646.27 ,  p-value: 0
    ---------------------------------
    Multiple R-squared   | 0.989867 |
    Adjusted R-squared   | 0.988336 |
    ---------------------------------
    
    ---------------------------------
    Normality test       | p-value  |
    ---------------------------------
    Anderson-Darling     | 0.384558 |
    Chi-Squared          | 0.808498 |
    Kolmogorov-Smirnov   | 0.623556 |
    ---------------------------------
    
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     Backward  BIC
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Basis( [1,X1,X2,(X1) * (X2),X3,(X1) * (X3),(X2) * (X3),(X1) * (X2) * (X3),X4,(X1) * (X4),(X2) * (X4),(X1) * (X2) * (X4),(X3) * (X4),(X1) * (X3) * (X4),(X2) * (X3) * (X4),X1^2,X1^3,X2^2,X2^3,X3^2,X3^3,X4^2,X4^3]#23 )
    
    Coefficients:
                       | Estimate    | Std Error   | t value     | Pr(>|t|)    |
    ----------------------------------------------------------------------------
    1                  | 13.5485     | 0.717251    | 18.8896     | 2.3713e-32  |
    X1                 | -5.50901    | 1.12662     | -4.88987    | 4.6462e-06  |
    X2                 | -16.0279    | 1.21304     | -13.2129    | 2.06943e-22 |
    (X1) * (X2)        | 11.1859     | 1.39804     | 8.00117     | 5.26182e-12 |
    X3                 | -6.52078    | 1.4938      | -4.36523    | 3.52047e-05 |
    (X1) * (X2) * (X3) | 17.3258     | 1.54802     | 11.1922     | 1.817e-18   |
    X4                 | -9.55887    | 1.21411     | -7.87314    | 9.5434e-12  |
    (X1) * (X4)        | -2.93384    | 1.3133      | -2.23395    | 0.0280807   |
    (X2) * (X4)        | 5.13282     | 1.22812     | 4.17941     | 6.99762e-05 |
    (X3) * (X4)        | 12.2915     | 1.27098     | 9.67088     | 2.12107e-15 |
    X1^3               | 14.2361     | 0.969488    | 14.6842     | 3.72177e-25 |
    X2^3               | -12.2284    | 0.949904    | -12.8733    | 9.23801e-22 |
    X3^2               | 13.9612     | 1.3549      | 10.3042     | 1.10315e-16 |
    X4^3               | -2.96765    | 0.927461    | -3.19976    | 0.00192691  |
    ----------------------------------------------------------------------------
    
    Residual standard error: 0.90562 on 86 degrees of freedom
    F-statistic: 712.19 ,  p-value: 0
    ---------------------------------
    Multiple R-squared   | 0.990797 |
    Adjusted R-squared   | 0.989405 |
    ---------------------------------
    
    ---------------------------------
    Normality test       | p-value  |
    ---------------------------------
    Anderson-Darling     | 0.434157 |
    Chi-Squared          | 0.355962 |
    Kolmogorov-Smirnov   | 0.807624 |
    ---------------------------------
    
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     Both  BIC
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Basis( [1,X1,X2,(X1) * (X2),X3,(X1) * (X3),(X2) * (X3),(X1) * (X2) * (X3),X4,(X1) * (X4),(X2) * (X4),(X1) * (X2) * (X4),(X3) * (X4),(X1) * (X3) * (X4),(X2) * (X3) * (X4),X1^2,X1^3,X2^2,X2^3,X3^2,X3^3,X4^2,X4^3]#23 )
    
    Coefficients:
                       | Estimate    | Std Error   | t value     | Pr(>|t|)    |
    ----------------------------------------------------------------------------
    1                  | 12.7086     | 0.624644    | 20.3453     | 7.94404e-35 |
    X1                 | -5.46036    | 1.10552     | -4.93919    | 3.75912e-06 |
    X2                 | -15.855     | 1.19992     | -13.2134    | 1.65462e-22 |
    X4                 | -9.23488    | 1.1925      | -7.74411    | 1.63394e-11 |
    (X1) * (X2) * (X3) | 16.9437     | 1.53474     | 11.0401     | 3.14529e-18 |
    X3^3               | 8.78174     | 0.688698    | 12.7512     | 1.29079e-21 |
    (X1) * (X2)        | 11.2068     | 1.39616     | 8.02686     | 4.36462e-12 |
    (X3) * (X4)        | 11.8023     | 1.03538     | 11.399      | 5.99206e-19 |
    X4^3               | -2.95993    | 0.922675    | -3.20799    | 0.00187159  |
    (X2) * (X4)        | 4.98183     | 1.18419     | 4.20694     | 6.26974e-05 |
    X1^3               | 14.1106     | 0.968097    | 14.5756     | 4.49373e-25 |
    X2^3               | -12.3915    | 0.951199    | -13.0273    | 3.77309e-22 |
    (X1) * (X4)        | -2.78756    | 1.28899     | -2.1626     | 0.0333158   |
    ----------------------------------------------------------------------------
    
    Residual standard error: 0.90426 on 87 degrees of freedom
    F-statistic: 773.79 ,  p-value: 0
    ---------------------------------
    Multiple R-squared   | 0.990718 |
    Adjusted R-squared   | 0.989437 |
    ---------------------------------
    
    ---------------------------------
    Normality test       | p-value  |
    ---------------------------------
    Anderson-Darling     | 0.128032 |
    Chi-Squared          | 0.317021 |
    Kolmogorov-Smirnov   | 0.606542 |
    ---------------------------------
